(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{495:function(s,a,t){"use strict";t.r(a);var n=t(25),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"swap交换分区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#swap交换分区"}},[s._v("#")]),s._v(" swap交换分区")]),s._v(" "),t("p",[s._v("​\t　在 Linux系统中，SWAP（交换分区）可以把一部分硬盘空间虚拟成内存使用，将系统内非活动内存换页到"),t("code",[s._v("SWAP")]),s._v("，以提高系统可用内存。虽说使用"),t("strong",[s._v("磁盘空间作为内存会影响程序运行的效率")]),s._v("，但至少不会让服务器死机。注意，生产环境不建议配置"),t("code",[s._v("SWAP")]),s._v("。")]),s._v(" "),t("h2",{attrs:{id:"新建交换分区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#新建交换分区"}},[s._v("#")]),s._v(" 新建交换分区")]),s._v(" "),t("p",[s._v("​\t　首先，创建一块空间，这里的文件路径可以任意，块的大小也是任意设定的，一般设置成"),t("code",[s._v("1M")]),s._v("，块的数量是"),t("code",[s._v("swap")]),s._v("交换分区的大小。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 语法格式")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/zero "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("of")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("文件路径"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bs")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("块的大小"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("块的数量"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定一块1024M的交换分区")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 官方建议交换分区为物理内存的1.5倍")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/zero "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("of")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/mnt/ice.swap "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bs")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1M "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("​\t　然后，将文件设置为交换分区文件，并启动。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置交换分区文件权限为600")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /mnt/ice.swap\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将文件设置为交换分区文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkswap")]),s._v(" /mnt/ice.swap\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用交换分区文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("swapon")]),s._v(" /mnt/ice.swap\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意：提示如下错误说明分区文件已被重复挂载")]),s._v("\nswapon: /mnt/ice.swap: "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("swapon")]),s._v(" failed: Device or resource busy\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("​\t　修改配置文件"),t("code",[s._v("/etc/rc.local")]),s._v("，并设置开机时，自动启动"),t("code",[s._v("swap")]),s._v("分区。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果在 /etc/rc.local中有 swapoff -a 需要修改为 swapon -a")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/rc.local\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 /etc/fstab 中添加如下一行，使得开机时自动启动swap分区")]),s._v("\n/mnt/ice.swap swap swap defaults "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("​\t　接着，修改 "),t("code",[s._v("swpapiness")]),s._v(" 参数，该参数值用来确定系统对 "),t("code",[s._v("Swap")]),s._v(" 分区的使用规则。当 "),t("code",[s._v("swappiness")]),s._v(" 为 "),t("code",[s._v("0")]),s._v(" 时，表示最大限度地使用物理内存，即在物理内存全部使用完之后，再使用 "),t("code",[s._v("Swap")]),s._v(" 分区 。")]),s._v(" "),t("p",[s._v("​\t　当 "),t("code",[s._v("swappiness")]),s._v(" 为 "),t("code",[s._v("0-100")]),s._v(" 时，如为 "),t("code",[s._v("20")]),s._v("，则表示当物理内存剩下 "),t("code",[s._v("20%")]),s._v(" 时，就使用 "),t("code",[s._v("Swap")]),s._v(" ；当 "),t("code",[s._v("swappiness")]),s._v(" 为 "),t("code",[s._v("100")]),s._v(" 时，表示积极使用 "),t("code",[s._v("Swap")]),s._v(" 分区，系统会将内存中的数据及时置换到 Swap 分区。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时设置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/proc/sys/vm/swappiness\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久设置,在 /etc/sysctl.conf最后添加")]),s._v("\nvm.swappiness"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"关闭分区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关闭分区"}},[s._v("#")]),s._v(" 关闭分区")]),s._v(" "),t("p",[s._v("​\t　如果觉得内存又足够了不需要分区，可以将 swappiness 调低，又或者将该分区关闭，")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭分区")]),s._v("\nswapoff "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("swap文件路径"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 取消自动挂载，将我们添加的自启动去掉")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/fstab\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确认分区已关闭")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v(" -m\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置 swappiness 参数")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时设置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/proc/sys/vm/swappiness\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久设置，将我们设置的参数去掉")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/sysctl.conf\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最后删除不需要的分区文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf /mnt/ice.swap\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("h2",{attrs:{id:"扩展分区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#扩展分区"}},[s._v("#")]),s._v(" 扩展分区")]),s._v(" "),t("p",[s._v("​\t　如果在使用的过程中，发现分区不够用了，可以对分区进行拓展，"),t("strong",[s._v("按步骤新建一个分区，启动就可以用了")]),s._v("。")])])}),[],!1,null,null,null);a.default=e.exports}}]);