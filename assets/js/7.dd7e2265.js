(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{397:function(s,t,a){s.exports=a.p+"assets/img/image-7879878.01cf1aa9.png"},398:function(s,t,a){s.exports=a.p+"assets/img/inage-11098989.776b876a.jpeg"},399:function(s,t,a){s.exports=a.p+"assets/img/20150924173757246.34180726.png"},400:function(s,t,a){s.exports=a.p+"assets/img/imgae-8989.c6f62727.jpg"},401:function(s,t,a){s.exports=a.p+"assets/img/image-20211201002702760.84bbb29a.png"},402:function(s,t,a){s.exports=a.p+"assets/img/image-20211201023650295.c0fe0300.png"},403:function(s,t,a){s.exports=a.p+"assets/img/image-20211201023948903.79138854.png"},404:function(s,t,a){s.exports=a.p+"assets/img/image-20211201062443568.ee578f7a.png"},405:function(s,t,a){s.exports=a.p+"assets/img/image-20211129130914741.2940a1a9.png"},406:function(s,t,a){s.exports=a.p+"assets/img/image-20211129201115526.6f8b88fa.png"},407:function(s,t,a){s.exports=a.p+"assets/img/image-20211130002107774.a93879d8.png"},408:function(s,t,a){s.exports=a.p+"assets/img/image-20211212022246581.29c2dee8.png"},537:function(s,t,a){"use strict";a.r(t);var n=a(25),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"gitlab-ci"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-ci"}},[s._v("#")]),s._v(" GitLab CI")]),s._v(" "),n("h2",{attrs:{id:"简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),n("p",[s._v("​\t　DevOps 是 "),n("code",[s._v("Development")]),s._v(" 和 "),n("code",[s._v("Operations")]),s._v(" 的合成词，其目标是要"),n("strong",[s._v("加强开发人员、测试人员、运维人员之间的沟通协调")]),s._v("。Docker 容器为 DevOps 提供了"),n("strong",[s._v("统一的运行环境")]),s._v("，真正实现了"),n("strong",[s._v("一次构建，到处运行")]),s._v("的部署方式。")]),s._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{src:a(397),height:"200",width:"400"}})]),s._v(" "),n("h3",{attrs:{id:"敏捷开发论"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#敏捷开发论"}},[s._v("#")]),s._v(" 敏捷开发论")]),s._v(" "),n("p",[s._v("​\t　敏捷开发（Agile）是一种以人为核心、迭代、循序渐进的开发方法。在敏捷开发中，软件项目的构建被切分成多个子项目，"),n("strong",[s._v("各个子项目的成果都经过测试，具备集成和可运行的特征")]),s._v("。")]),s._v(" "),n("p",[s._v("​\t　敏捷开发并不追求前期完美的设计、完美编码，而是力求在"),n("strong",[s._v("很短的周期内开发出产品的核心功能")]),s._v("，尽早发布出可用的版本。然后在后续的生产周期内，按照新需求不断迭代升级，完善产品。")]),s._v(" "),n("p",[s._v("​\t　敏捷开发的实现主要包括 "),n("code",[s._v("SCRUM")]),s._v("、"),n("code",[s._v("XP")]),s._v("（极限编程）、Crystal Methods、FDD（特性驱动开发）等。其中 SCRUM 与 XP 最为流行。")]),s._v(" "),n("p",[s._v("（1）SCRUM")]),s._v(" "),n("p",[s._v("​\t　SCRUM 是一种开发流程框架，SCRUM 框架中包含三个角色，三个工件，四个会议，听起来很复杂，其目的是为了"),n("strong",[s._v("有效地完成每一次迭代周期的工作")]),s._v("。")]),s._v(" "),n("p",[s._v("​\t　在项目启动之前，会由团队的产品负责人（Product owner）按照需求优先级来明确出一份项目的整体需求"),n("code",[s._v("Product Backlog")]),s._v("（ 项目的整体需求），为项目做出整体排期。")]),s._v(" "),n("p",[s._v("​\t　随后在每一个小的迭代周期里，团队会根据计划（Sprint Plan Meeting）确定本周期的"),n("code",[s._v("Sprint Backlog")]),s._v("（需求列表），再细化成一个个"),n("code",[s._v("Task")]),s._v("（ 具体开发任务），分配给团队成员，进行具体开发工作。每一天团队成员都会进行 "),n("code",[s._v("Daily meeting")]),s._v(" （监控项目进度），根据情况更新自己的 Task 状态，整个团队更新 "),n("code",[s._v("Sprint burn down chart")]),s._v("（冲刺燃尽图），记录当前周期的需求完成情况。")]),s._v(" "),n("p",[s._v("​\t　当这一周期的 "),n("code",[s._v("Sprint backlog")]),s._v("（冲刺周期内的需求） 全部完成，团队会进行 "),n("code",[s._v("Spring review meeting")]),s._v("（冲刺评审会议），让团队成员们演示成果。一切顺利的话，会发布出这一版本的 "),n("code",[s._v("Release")]),s._v("（新的可用版本），并且进行 Sprint 回顾会议（Sprint Retrospective Meeting）。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(398),alt:"inage-11098989"}})]),s._v(" "),n("p",[s._v("（2）XP 极限编程")]),s._v(" "),n("p",[s._v("​\t　XP 由价值观、原则、实践和行为四个部分组成，它们彼此相互依赖、关联， 并通过行为贯穿于整个生命期。XP四大价值观是沟通、简单、反馈、勇气以及谦逊。五个原则是"),n("strong",[s._v("快速反馈")]),s._v("、"),n("strong",[s._v("简单性假设")]),s._v("、"),n("strong",[s._v("逐步修改")]),s._v("、"),n("strong",[s._v("提倡更改")]),s._v("、"),n("strong",[s._v("优质工作")]),s._v("。")]),s._v(" "),n("p",[s._v("​\t　XP 极限编程的最佳实践有，"),n("strong",[s._v("客户负责业务决策，开发团队负责技术决策")]),s._v("；秉承"),n("strong",[s._v("持续集成，小步快走")]),s._v("的哲学；侧重于"),n("strong",[s._v("实践")]),s._v("，使用"),n("strong",[s._v("测试先行")]),s._v(" 或者 "),n("strong",[s._v("结对编程")]),s._v("保证代码质量；强调"),n("strong",[s._v("简单设计")]),s._v("、"),n("strong",[s._v("够用就好")]),s._v("的价值观，使用"),n("strong",[s._v("单一职责原则")]),s._v("、"),n("strong",[s._v("最少知识原则")]),s._v("设计模式开发，使得代码保持"),n("strong",[s._v("良好的可扩展性")]),s._v("以及"),n("strong",[s._v("重构")]),s._v("的可能。")]),s._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{src:a(399),height:"400",width:"500"}})]),s._v(" "),n("h3",{attrs:{id:"持续集成与交付"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#持续集成与交付"}},[s._v("#")]),s._v(" 持续集成与交付")]),s._v(" "),n("p",[s._v("​\t　"),n("strong",[s._v("持续集成")]),s._v("（"),n("code",[s._v("Continuous integration")]),s._v("，简称 "),n("code",[s._v("CI")]),s._v("）是指频繁地（一天多次）将代码集成到主干。开发人员提交了新代码之后，"),n("strong",[s._v("自动进行构建、（单元）测试")]),s._v("，这样可以"),n("strong",[s._v("快速发现错误")]),s._v("，并"),n("strong",[s._v("防止分支大幅偏离主干")]),s._v("。"),n("code",[s._v("GitLab Runner")]),s._v("提供了持续集成的解决方案（开发使用）。")]),s._v(" "),n("p",[s._v("​\t　"),n("strong",[s._v("持续交付")]),s._v("（"),n("code",[s._v("Continuous delivery")]),s._v("，简称 "),n("code",[s._v("CD")]),s._v("）是指是频繁地将软件的新版本，自动部署到"),n("strong",[s._v("预生产环境")]),s._v("，交付给质量团队或者用户以供评审，如果评审通过，代码就进入生产阶段。持续交付可以看作持续集成的下一步，强调代码不管怎么更新，"),n("strong",[s._v("软件是随时可以交付的")]),s._v("。")]),s._v(" "),n("p",[s._v("​\t　"),n("strong",[s._v("持续部署")]),s._v("（Continuous deployment）是指代码通过评审以后，自动部署到"),n("strong",[s._v("生产环境")]),s._v("。持续部署可以看作持续交付的下一步，强调代码"),n("strong",[s._v("随时都可部署到生产环境")]),s._v("的。持续部署的前提是能"),n("strong",[s._v("自动化完成测试、构建、部署")]),s._v("等步骤。"),n("code",[s._v("Jenkins")]),s._v("提供了持续交付与部署的解决方案（运维使用）。")]),s._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{src:a(400),height:"300",width:"450"}})]),s._v(" "),n("p",[s._v("​\t　根据持续集成的设计，代码从提交到生产，有代码"),n("strong",[s._v("提交")]),s._v("、"),n("strong",[s._v("第一轮测试")]),s._v("、"),n("strong",[s._v("构建")]),s._v("、"),n("strong",[s._v("第二轮测试")]),s._v("、"),n("strong",[s._v("部署")]),s._v("、"),n("strong",[s._v("回滚")]),s._v("等阶段。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(401),alt:"image-20211201002702760"}})]),s._v(" "),n("p",[s._v("​\t　开发者向代码仓库"),n("strong",[s._v("提交")]),s._v("代码；代码仓库对 commit 操作配置了钩子（hook），只要提交代码或者合并进主干（develop），就会进行"),n("strong",[s._v("第一轮测试")]),s._v("（单元测试）。")]),s._v(" "),n("p",[s._v("​\t　通过第一轮测试，代码就可以合并进主干（release）进行交付。首先，对主干进行"),n("strong",[s._v("构建")]),s._v("（build），如安装依赖、配置各种资源（样式表、JS脚本、图片）等；构建完成后，即可进行"),n("strong",[s._v("第二轮全面测试")]),s._v("（单元测试+集成测试+端对端测试）。"),n("code",[s._v("Jenkins")]),s._v("可以将构建和测试在一次运行中执行完成。")]),s._v(" "),n("p",[s._v("​\t　通过了第二轮测试，当前代码（master）就是一个可以直接"),n("strong",[s._v("部署")]),s._v("的版本（artifact）。将这个版本的所有文件打包存档，发送到生产服务器。生产服务器将打包文件，解包成本地的一个目录，再将运行路径的符号链接（symlink）指向这个目录，然后重新启动应用。")]),s._v(" "),n("p",[s._v("​\t　一旦当前版本发生问题，就要"),n("strong",[s._v("回滚")]),s._v("到上一个版本的构建结果。可以通过"),n("code",[s._v("Dokcer")]),s._v("或者"),n("code",[s._v("ln软连接指向上一个版本的目录")]),s._v("，实现妙级回滚。")]),s._v(" "),n("p",[s._v("​\t　特别的，所有测试都以自动化为主，新版本的每一个更新点都必须测试到。少数无法自动化的测试用例，就要人工跑；如果测试的覆盖率不高，进入后面的部署阶段后，很可能会出现严重的问题。")]),s._v(" "),n("h3",{attrs:{id:"流水线与作业"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#流水线与作业"}},[s._v("#")]),s._v(" 流水线与作业")]),s._v(" "),n("p",[s._v("​\t　一次 "),n("code",[s._v("Pipeline")]),s._v(" 相当于"),n("strong",[s._v("一次构建任务")]),s._v("，里面可以包含多个流程，如安装依赖、运行测试、编译、部署测试服务器、部署生产服务器等流程。任何提交或者 Merge Request 的合并都可以触发 Pipeline。")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("+------------------+  trigger  +----------------+\n|   Commit / MR    +----------\x3e+    Pipeline    |\n+------------------+           +----------------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("​\t　"),n("code",[s._v("Stages")]),s._v(" 表示"),n("strong",[s._v("构建阶段")]),s._v("，一次 Pipeline 可以定义多个 Stages，"),n("strong",[s._v("所有 Stages 会按照顺序运行")]),s._v("，即当一个 Stage 完成后，下一个 Stage 才会开始；只有当所有 Stages 完成后，该构建任务 (Pipeline) 才会成功；如果任何一个 Stage 失败，那么后面的 Stages 不会执行，该构建任务 (Pipeline) 失败。")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("+--------------------------------------------------------+\n|  Pipeline                                              |\n|                                                        |\n|  +-----------+     +------------+      +------------+  |\n|  |  Stage 1  |----\x3e|   Stage 2  |-----\x3e|   Stage 3  |  |\n|  +-----------+     +------------+      +------------+  |\n+--------------------------------------------------------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("​\t　"),n("code",[s._v("Jobs")]),s._v(" 表示构建工作，表示"),n("strong",[s._v("某个 Stage 里面执行的工作")]),s._v("。我们可以在 Stages 里面定义多个 Jobs，"),n("strong",[s._v("同 Stage 中的 Jobs 会并行执行")]),s._v("；相同 Stage 中的 Jobs 都执行成功时，该 Stage 才会成功；如果任何一个 Job 失败，那么该 Stage 失败，即该构建任务 (Pipeline) 失败。")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("+------------------------------------------+\n|  Stage 1                                 |\n|                                          |\n|  +---------+  +---------+  +---------+   |\n|  |  Job 1  |  |  Job 2  |  |  Job 3  |   |\n|  +---------+  +---------+  +---------+   |\n+------------------------------------------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h2",{attrs:{id:"快速开始"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#快速开始"}},[s._v("#")]),s._v(" 快速开始")]),s._v(" "),n("p",[s._v("​\t　"),n("code",[s._v("GitLab CI")]),s._v(" 用于管理各个项目的构建状态；"),n("code",[s._v("GitLab Runner")]),s._v("用于执行持续构建，可以安装到不同的机器上，使得构建任务运行期间并不会影响到 GitLab 的性能。")]),s._v(" "),n("h3",{attrs:{id:"runnber-docker"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#runnber-docker"}},[s._v("#")]),s._v(" Runnber Docker")]),s._v(" "),n("p",[s._v("​\t　在此，我们使用Docker安装"),n("code",[s._v("GitLab Runnber")]),s._v("。首先，按照如下结构新建文件及目录。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("--/usr/local/docker\n---- runner                           "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 工作目录")]),s._v("\n------ environment                    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建目录")]),s._v("\n--------- Dockerfile                  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定制GitLab Runnber镜像")]),s._v("\n--------- daemon.json                 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置加速器和仓库地址")]),s._v("\n--------- jdk-8u311-linux-x64.tar.gz  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 搭建Java部署环境")]),s._v("\n--------- apache-maven-3.5.3-bin.tar  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 搭建Java部署环境")]),s._v("\n--------- settings.xml                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# maven配置文件,若有私服必须配置")]),s._v("\n------ docker-compose.yml             "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定制Runnber镜像启动脚本")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("（1）Dockerfile")]),s._v(" "),n("p",[s._v("​\t　"),n("code",[s._v("GitLab Runnber")]),s._v("是为所有项目提供持续集成服务的，所有，我们需要以"),n("code",[s._v("gitlab-runner")]),s._v("为基础，定制可以构建Java项目的"),n("code",[s._v("Runnber")]),s._v("镜像。")]),s._v(" "),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# gitlab-runner的版本要和GitLab的版本一致")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" gitlab/gitlab"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("runner\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 Docker")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" curl "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("sSL https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//get.daocloud.io/docker "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" sh\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" daemon.json /etc/docker/daemon.json\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 Docker Compose")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /usr/local/bin\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" curl "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("L https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//get.daocloud.io/docker/compose/releases/download/v2.1.1/docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("compose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("`uname "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s`"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("`uname "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("m` "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" /usr/local/bin/docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("compose\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" chmod +x docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("compose\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 Java")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p /usr/local/java\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /usr/local/java\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" jdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("8u311"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("linux"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("x64.tar.gz /usr/local/java\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf jdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("8u311"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("linux"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("x64.tar.gz && \\\n    rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fr jdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("8u311"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("linux"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("x64.tar.gz\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 Maven")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p /usr/local/maven\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /usr/local/maven\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("maven"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.5.3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("bin.tar.gz /usr/local/maven\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("maven"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.5.3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("bin.tar.gz && \\\n    rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fr apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("maven"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.5.3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("bin.tar.gz\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意nexus仓库配置")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" settings.xml /usr/local/maven/apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("maven"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.5.3/conf/settings.xml\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置环境变量")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" JAVA_HOME /usr/local/java/jdk1.8.0_311\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" MAVEN_HOME /usr/local/maven/apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("maven"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.5.3\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" PATH $PATH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$JAVA_HOME/bin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$MAVEN_HOME/bin\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br")])]),n("p",[s._v("（2） daemon.json")]),s._v(" "),n("p",[s._v("​\t　Docker仓库的地址"),n("code",[s._v("insecure-registries")]),s._v("，请按真实情况配置。")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"registry-mirrors"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://registry.docker-cn.com"')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"insecure-registries"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.75.131:5000"')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("（3）docker-compose.yml")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.1'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gitlab-runner")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" environment\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" gitlab"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("runner\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以真正root管理员的角色操作容器")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("privileged")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /usr/local/docker/runner/config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/gitlab"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("runner\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /var/run/docker.sock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/run/docker.sock\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("​\t　最后，运行"),n("code",[s._v("docker-compose up -d")]),s._v(" 安装GitLab Runner。并且，还需要给如下文件开发权限。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(" sudo chmod 666 /var/run/docker.sock\n sudo chmod 666 /usr/local/maven/repo\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"注册runner"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注册runner"}},[s._v("#")]),s._v(" 注册Runner")]),s._v(" "),n("p",[s._v("​\t　首先， 以交互的方式进入"),n("code",[s._v("gitlab-runner")]),s._v("，并执行"),n("code",[s._v("gitlab-runner")]),s._v("命令进行注册，"),n("code",[s._v("register")]),s._v("是命令参数。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it gitlab-runner gitlab-runner register\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("​\t　然后，在GitLab中，在"),n("code",[s._v("设置")]),s._v(" -> "),n("code",[s._v("CI/CD")]),s._v("  中，查看Runner的注册"),n("code",[s._v("网站")]),s._v("和"),n("code",[s._v("令牌")]),s._v("信息。特别的，若采用的是公网GitLab，这里"),n("strong",[s._v("共享Runner是需要关闭的")]),s._v("，否则会和刚才自己安装Runner的引起冲突的。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(402),alt:"image-20211201023650295"}})]),s._v(" "),n("p",[s._v("​\t　在"),n("code",[s._v("shell")]),s._v("中依次输入"),n("code",[s._v("网站")]),s._v("和"),n("code",[s._v("令牌")]),s._v("，并设定触发CI的事件。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输入 GitLab 地址")]),s._v("\nPlease enter the gitlab-ci coordinator URL "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e.g. https://gitlab.com/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\nhttps://gitlab.com/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输入 GitLab Token")]),s._v("\nPlease enter the gitlab-ci token "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" this runner:\n令牌\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输入 Runner 的说明")]),s._v("\nPlease enter the gitlab-ci description "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" this runner:\n可以为空\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置 Tag，可以用于指定在构建规定的 tag 时触发 ci")]),s._v("\nPlease enter the gitlab-ci tags "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" this runner "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("comma separated"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n可以为空  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示只要提交代码就触发 ci")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# deploy  # 只有标记deploy才会触发 ci")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 选择 runner 执行器，这里我们选择的是 shell")]),s._v("\nPlease enter the executor: virtualbox, docker+machine, parallels, shell, ssh, docker-ssh+machine, kubernetes, docker, docker-ssh:\nshell\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("p",[s._v("​\t　刷新页面，可以看到Runner已经注册完成了。运行"),n("code",[s._v("cat config/config.toml")]),s._v("命令即可查看刚才注册信息。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(403),alt:"image-20211201023948903"}})]),s._v(" "),n("p",[s._v("​\t　进入"),n("code",[s._v("gitlab-ci")]),s._v("容器后，还可以运行如下命令，查询相关信息。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除注册信息")]),s._v("\ngitlab-ci-multi-runner unregister --name "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"名称"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看注册列表")]),s._v("\ngitlab-ci-multi-runner list\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("​\t　另外，为保证能够正常集成，可能还需要新增"),n("code",[s._v("ssh密钥")]),s._v("、将"),n("code",[s._v("gitlab-runner")]),s._v(" 账户加入 "),n("code",[s._v("root 组")]),s._v("等操作。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装完 GitLab Runner 后系统会增加一个 gitlab-runner 账户，需要将它加进 root 组")]),s._v("\ngpasswd -a gitlab-runner root\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新增ssh密钥")]),s._v("\nssh-keygen -t rsa -C "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"你在 GitLab 上的邮箱地址"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"流水线脚本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#流水线脚本"}},[s._v("#")]),s._v(" 流水线脚本")]),s._v(" "),n("p",[s._v("​\t　一个"),n("code",[s._v(".gitlab-ci.yml")]),s._v("就代表一个流水线。首先，在项目根目录下新建"),n("code",[s._v(".gitlab-ci.yml")]),s._v("配置文件，并编写如下测试用例。")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stages")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" test\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行测试用例")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("test")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "Hello GitLab Runner"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("​\t　将测试脚本提交到GitLab，稍等片刻，即可查看运行结果。每次触发"),n("code",[s._v("CI")]),s._v("的时候，"),n("code",[s._v("GitLab Runner")]),s._v("都会拉取最新代码到项目部署目录下。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(404),alt:"image-20211201062443568"}})]),s._v(" "),n("h2",{attrs:{id:"手动部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#手动部署"}},[s._v("#")]),s._v(" 手动部署")]),s._v(" "),n("p",[s._v("​\t　要想实现自动部署，首先，就要先了解手动部署的全过程。在此，通过手动部署itoken项目，来表述这一过程。")]),s._v(" "),n("h3",{attrs:{id:"itoken-dependencies"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#itoken-dependencies"}},[s._v("#")]),s._v(" itoken-dependencies")]),s._v(" "),n("p",[s._v("​\t　首先，需要将"),n("code",[s._v("itoken-dependencies")]),s._v("项目"),n("strong",[s._v("打包到Nexus私服")]),s._v("，在"),n("code",[s._v("pom.xml")]),s._v("中新增如下配置，参考"),n("a",{attrs:{href:"../microservice/nexus.html#打包项目到私服",target:"_blank"}},[s._v("这里")]),s._v("进行配置。")]),s._v(" "),n("div",{staticClass:"language-xml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--打包项目到私服--\x3e")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("distributionManagement")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n     "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("repository")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n         "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("nexus-releases"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n         "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("Nexus Release Repository"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n         "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("url")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("http://101.43.15.250:8081/repository/maven-releases/"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("url")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n     "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("repository")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n     "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("snapshotRepository")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n         "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("nexus-snapshots"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n         "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("Nexus Snapshot Repository"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n         "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("url")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("http://101.43.15.250:8081/repository/maven-snapshots/"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("url")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n     "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("snapshotRepository")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("distributionManagement")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("​\t　然后，"),n("strong",[s._v("本地")]),s._v("先执行"),n("code",[s._v("cd itoken-dependencies")]),s._v("，再使用"),n("code",[s._v("mvn deploy")]),s._v("打包，即可将"),n("code",[s._v("itoken-dependencies")]),s._v("项目打包到远程仓库中。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(405),alt:"image-20211129130914741"}})]),s._v(" "),n("p",[s._v("（2）itoken-config")]),s._v(" "),n("p",[s._v("​\t　首先，在"),n("code",[s._v("itoken-config")]),s._v("项目中的"),n("code",[s._v("pom.xml")]),s._v("中新增如下配置，用于从"),n("code",[s._v("Nexus Repository")]),s._v("下载"),n("code",[s._v("itoken-dependencies")]),s._v("等依赖，参考"),n("a",{attrs:{href:"../microservice/nexus.html#配置代理仓库",target:"_blank"}},[s._v("这里")]),s._v("进行配置，修改完成后将变更提交到Git仓库。特别的，"),n("strong",[n("code",[s._v("itoken")]),s._v("所有的项目都需要这样改动，后面的项目不在赘述")]),s._v("。")]),s._v(" "),n("div",{staticClass:"language-xml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--依赖管理--\x3e")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("repositories")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("repository")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("nexus"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("Nexus Repository"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("url")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("http://101.43.15.250:8081/repository/maven-public/"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("url")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("snapshots")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("true"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("snapshots")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("releases")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("true"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("releases")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("repository")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("repositories")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("​\t　接下来，在远程服务器上运行如下命令，并将生成的秘钥增加到GitLab中的"),n("code",[s._v("用户头像")]),s._v("->"),n("code",[s._v("设置")]),s._v("->"),n("code",[s._v("SSH 密钥")]),s._v("中即可。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成密钥")]),s._v("\nssh-keygen -t rsa -C "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"your_email@example.com"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看密钥")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /root/.ssh/id_rsa.pub\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"itoken-config"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#itoken-config"}},[s._v("#")]),s._v(" itoken-config")]),s._v(" "),n("p",[s._v("​\t　然后，安装"),n("code",[s._v("JDK")]),s._v("和"),n("code",[s._v("Maven")]),s._v("环境。接着将"),n("code",[s._v("itoken-config")]),s._v("项目都"),n("code",[s._v("clone")]),s._v("到远程服务器上，并打包、运行"),n("code",[s._v("itoken-config")]),s._v("项目。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新建itoken项目目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/local/docker/itoken\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入itoken项目")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/docker/itoken\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装Git命令")]),s._v("\nyum -y "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 克隆itoken-config目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone git@gitlab.com:springclouditoken/itoken-config.git\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打包itoken-config项目")]),s._v("\nmvn clean package \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入target目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" target\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新建部署目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" docker\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移动jar包到部署目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" itoken-config-1.0.0-SNAPSHOT.jar docker\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入部署目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" docker\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在docker目录下，编写Dockerfile")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" Dockerfile\n\nFROM openjdk:8-jre\nWORKDIR /app\nCOPY itoken-config-1.0.0-SNAPSHOT.jar "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\nCMD java -jar itoken-config-1.0.0-SNAPSHOT.jar\nEXPOSE "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建镜像")]),s._v("\ndocker build -t sh086/itoken-config "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br")])]),n("p",[s._v("​\t　编写"),n("code",[s._v("itoken-config")]),s._v("项目的"),n("code",[s._v("docker-compose.yml")]),s._v("文件，再运行"),n("code",[s._v("docker-compose up -d")]),s._v("命令启动项目。")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.1'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("itoken-config")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sh086/itoken"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" itoken_config\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 8888"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" config_network\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("config_network")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("​\t　访问"),n("code",[s._v("http://101.43.15.250:8888/itoken-admin/dev/master")]),s._v("，若可以获取配置，则表明"),n("code",[s._v("itoken-config")]),s._v("项目已经成功部署了。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(406),alt:"image-20211129201115526"}})]),s._v(" "),n("h3",{attrs:{id:"itoken-eureka"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#itoken-eureka"}},[s._v("#")]),s._v(" itoken-eureka")]),s._v(" "),n("p",[s._v("​\t　由于Eureka采用"),n("strong",[s._v("集群")]),s._v("部署，所以要先增加"),n("code",[s._v("itoken-eureka-dev.yml")]),s._v("配置文件的"),n("code",[s._v("defaultZone")]),s._v("节点，完成后提交变更到GitLab。")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br")]),n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8761")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("eureka")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("instance")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hostname")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" host\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("client")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示是否将自己注册到Eureka，因为要构建集群环境，需要将自己注册到集群，所以应该开启")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("registerWithEureka")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示是否从Eureka获取注册信息，如果是单一节点，不需要同步其他Eureka节点，则可以设置为false")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 但如是Eureka集群，则应该设置为 true")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fetchRegistry")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceUrl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("defaultZone")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("eureka.instance.hostname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8761/eureka/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("eureka.instance.hostname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8762/eureka/\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("​\t　然后，先在"),n("code",[s._v("itoken-eureka")]),s._v("项目的"),n("code",[s._v("pom.xml")]),s._v("新增"),n("code",[s._v("Nexus Repository")]),s._v("配置并提交Git，再根据如下步骤完成"),n("code",[s._v("eureka")]),s._v("镜像定制。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入itoken目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/docker/itoken\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取代码")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone git@gitlab.com:springclouditoken/itoken-eureka.git\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入itoken-eureka项目")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" itoken-eureka\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打包")]),s._v("\nmvn clean package\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入打包目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" target\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新建部署目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" docker\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移动jar包到部署目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" itoken-eureka-1.0.0-SNAPSHOT.jar docker\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入部署目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" docker\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在docker目录下，编写Dockerfile")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" Dockerfile\n\nFROM openjdk:8-jre\nWORKDIR /app\nCOPY itoken-eureka-1.0.0-SNAPSHOT.jar "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\nCMD java -jar itoken-eureka-1.0.0-SNAPSHOT.jar\nEXPOSE "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8761")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建镜像")]),s._v("\ndocker build -t sh086/itoken-eureka "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("p",[s._v("​\t　接下来，编写"),n("code",[s._v("itoken-eureka")]),s._v("项目的"),n("code",[s._v("docker-compose.yml")]),s._v("文件。")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.1'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("itoken-eureka-1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sh086/itoken"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("eureka\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" itoken"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("eureka"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 8761"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8761")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" eureka_network\n\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("itoken-eureka-2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sh086/itoken"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("eureka\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" itoken"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("eureka"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 8762"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8761")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" eureka_network\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 需要指定默认网络，否则在down时，会提示错误")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("eureka_network")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("p",[s._v("​\t　最后，启动"),n("code",[s._v("itoken-eureka")]),s._v("项目，启动成功后，访问"),n("code",[s._v("8761")]),s._v("端口或者"),n("code",[s._v("8762")]),s._v("端口，都可正常访问Eureka。特别的，由于Eureka是集群模式，故端口展示的都是"),n("code",[s._v("8761")]),s._v("。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(407),alt:"image-20211130002107774"}})]),s._v(" "),n("h2",{attrs:{id:"持续集成实践"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#持续集成实践"}},[s._v("#")]),s._v(" 持续集成实践")]),s._v(" "),n("p",[s._v("​\t　"),n("code",[s._v("GitLab CI")]),s._v("部署目录文件结构如下，若构建中出现问题，可以进入GitLab Runner查看一下问题原因。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("--Project\n---- docker                    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 部署目录")]),s._v("\n-------- Dockerfile            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定制项目镜像")]),s._v("\n---------docker-compose.yml    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动项目")]),s._v("\n-----.gitlab-ci.yml            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 流水线脚本")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("​\t　注意，若通过"),n("code",[s._v("docker exec -it bash")]),s._v("进入容器后，手动在"),n("code",[s._v("Runner")]),s._v("容器中"),n("code",[s._v("build")]),s._v("应用，应该在构建完成后，要清除刚才手动构建生成的目录，否则可能会产生权限问题。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 清除target")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf target/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"gitlab-ci-yml"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-ci-yml"}},[s._v("#")]),s._v(" .gitlab-ci.yml")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stages")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" build\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" push\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" run\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" clean\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" build\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /usr/local/maven/apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("maven"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.5.3/bin/mvn clean package\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cp target/itoken"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.0.0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("SNAPSHOT.jar docker\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cd docker\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker build "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("t sh086/itoken"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config .\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 推送镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" push\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker login "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("u sh086 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p 密码\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker push sh086/itoken"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" run\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cd docker\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - docker-compose down")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("compose up "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("build\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 清理")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clean")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" clean\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker rmi $(docker images "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("q "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f dangling=true)\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - docker rm $(docker ps -a -q)")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br")])]),n("p",[s._v("​\t　注意，虽然在"),n("code",[s._v("docker-compose.yml")]),s._v("中设置了"),n("code",[s._v("networks")]),s._v("，但是，在"),n("code",[s._v("down")]),s._v("项目"),n("code",[s._v("itoken-eureka")]),s._v("时，还是会提示使用了"),n("code",[s._v("docker_itoken_network")]),s._v("的网络，不知道为什么？")]),s._v(" "),n("h3",{attrs:{id:"dockerfile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[s._v("#")]),s._v(" Dockerfile")]),s._v(" "),n("p",[s._v("（1）不依赖其他项目")]),s._v(" "),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" openjdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("jre\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" APP_VERSION 1.0.0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("SNAPSHOT\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" itoken"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$APP_VERSION.jar ./app.jar\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Djava.security.egd=file:/dev/./urandom"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./app.jar"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 8888\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("（2）依赖其他项目")]),s._v(" "),n("p",[s._v("​\t　建议直接将"),n("code",[s._v("Dockerize")]),s._v("打入"),n("code",[s._v("Runner")]),s._v("的"),n("code",[s._v("Docker")]),s._v("安装包中。")]),s._v(" "),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" openjdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("jre\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" APP_VERSION 1.0.0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("SNAPSHOT\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" DOCKERIZE_VERSION v0.6.1\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Dockerize会等到服务可以访问的时候才会启动后续命令")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# depends_on这个只是声明启动服务的先后顺序，不能确保在服务A启动成功后，才启动服务B")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" wget https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//github.com/jwilder/dockerize/releases/download/$DOCKERIZE_VERSION/dockerize"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("linux"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("amd64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$DOCKERIZE_VERSION.tar.gz \\\n    && tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("C /usr/local/bin "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("xzvf dockerize"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("linux"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("amd64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$DOCKERIZE_VERSION.tar.gz \\\n    && rm dockerize"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("linux"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("amd64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$DOCKERIZE_VERSION.tar.gz\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" itoken"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("eureka"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$APP_VERSION.jar ./app.jar\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 等101.53.15.240:8888可以访问的时候，再启动项目，最多等待5分支2")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dockerize"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-timeout"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5m"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-wait"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tcp://101.53.15.240:8888"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Djava.security.egd=file:/dev/./urandom"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./app.jar"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 8761\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("h3",{attrs:{id:"docker-compose-yml"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-yml"}},[s._v("#")]),s._v(" docker-compose.yml")]),s._v(" "),n("p",[s._v("​\t　此处以"),n("code",[s._v("itoken-config")]),s._v("项目的"),n("code",[s._v("docker-compose.yml")]),s._v("文件为例。")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.1'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("itoken-config")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sh086/itoken"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" itoken_config\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 8888"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("TZ")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Asia/Shanghai\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("SPRING_PROFILES_ACTIVE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("config_network")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 需要指定专门的网络，否则在多实例在down时，会提示错误")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("config_network")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("h3",{attrs:{id:"测试运行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试运行"}},[s._v("#")]),s._v(" 测试运行")]),s._v(" "),n("p",[s._v("​\t　以"),n("code",[s._v("itoken-config")]),s._v("为例，提交代码到分支上，"),n("code",[s._v("GitLab CI")]),s._v("就会自动进行构建，稍等一会，构建成功结果如下。访问"),n("code",[s._v("http://101.43.15.250:8888/itoken-admin/dev/master")]),s._v("，若可以获取配置，则表明"),n("code",[s._v("itoken-config")]),s._v("项目已经成功部署了。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(408),alt:"image-20211212022246581"}})]),s._v(" "),n("h2",{attrs:{id:"附录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#附录"}},[s._v("#")]),s._v(" 附录")]),s._v(" "),n("h3",{attrs:{id:"linux-runnber"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#linux-runnber"}},[s._v("#")]),s._v(" Linux Runnber")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Ubuntu 安装脚本")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -L https://packages.gitlab.com/install/repositories/runner/gitlab-ci-multi-runner/script.deb.sh "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gitlab-ci-multi-runner\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"gitlab-ci模板"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-ci模板"}},[s._v("#")]),s._v(" gitlab-ci模板")]),s._v(" "),n("p",[s._v("​\t　模板中的配置把把一次 "),n("code",[s._v("Pipeline")]),s._v(" 分成五个阶段，分别是安装依赖(install_deps)、运行测试(test)、编译(build)、部署测试服务器(deploy_test)、部署生产服务器(deploy_production)。")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义构建阶段，这里只有一个阶段 deploy")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stages")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" install_deps\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" test\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" build\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" deploy_test\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" deploy_production\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cache")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("CI_BUILD_REF_NAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" node_modules/\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" dist/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装依赖")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("install_deps")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" install_deps\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只有当 develop 分支有提交的时候才会触发相关的 Jobs")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("only")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" develop\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" master\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 需要执行的 shell 脚本")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm install\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行测试用例")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("test")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("only")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" develop\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" master\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm run test\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编译")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" build\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("only")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" develop\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" master\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm run clean\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm run build"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("client\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm run build"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("server\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 部署测试服务器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("deploy_test")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deploy_test\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("only")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" develop\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" pm2 delete app "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" true\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" pm2 start app.js "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name app\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 部署生产服务器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("deploy_production")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deploy_production\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("only")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" master\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" bash scripts/deploy/deploy.sh\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);